### 2장. 기능 들여다보기
- 문서, 타입, 색인 정의하기
- 엘라스틱서치 노드와 primary shard, replica shard 이해하기
- cURL과 데이터 집합으로 문서 색인하기
- 데이터를 찾고 가져오기
- 엘라스틱 서치 환경설정 옵션 세팅하기
- 다수의 노드로 작업하기 

#### 2.1 논리적인 배치 이해하기: 문서, 타입, 색인
- 색인, 타입, ID 조합은 하나의 문서를 유일하게 식별함
###### 2.1.1 문서
- 문서의 특징
  - 독립적이다, 필드와 값을 가지고 있음
  - 계층을 가질 수 있음 
  - 유연한 구조로 되어 잇음 

###### 2.1.2 타입
- 타입
  - 문서에 대한 논리적인 컨테이너 
  - 새로운 필드의 자동 감지는 엘라스틱 서치가 잘못 추측할 수 있음
  - 그래서 매핑을 정의하는 것이 안전함 

###### 2.1.3 색인
- 색인
  - 매핑 타입의 컨테이너
  - 독립적인 문서 덩어리
  - 각각의 색인을 디스크에 같은 파일 집합으로 저장

#### 2.2 물리적 배치 이해하기: 노드와 샤드
- 노드: 엘라스틱 서치를 실행하는 프로세스
  - 색인에 대한 데이터를 저장하는 파일들의 디렉토리
  - 노드에서 노드로 옮기는 가장 작은 단위
- primary shard: 색인 일부분
- replica shard: 주 샤드의 복사본 

###### 2.2.1 하나 혹은 그 이상의 노드를 갖는 클러스터 생성 
- 노드
  - 엘라스틱서치의 인스턴스
  - 다수의 노드는 같은 클러스터에 합류할 수 있음 
  - split brain(클러스터의 두 파트가 통신할 수 없어 다른 파트가 떨어져 나갔다고 생각하는 것) 발생 가능
- 문서의 색인과 검색
  - 문서는 랜덤한 주 샤드와 레플리카에 색인을 생성
  - 검색은 주 샤드나 레플리카의 상태에 상관업싱 전체 샤드에서 실행 

###### 2.2.2 주 샤드와 레플리카 샤드 이해하기 
- 샤드
  - 하나의 샤드는 하나의 루씬 색인(역 색인을 포함하는 파일들의 모음)
  - 레플리카 샤드는 언제든 수를 변경할 수 있음 
  - 그러나 주 샤드는 변경할 수 없음 

###### 2.2.3 클러스터에 샤드 분산하기
- 수평적 확장: 클러스터에 노드를 추가하는 방법으로 확장 
  - 샤드 사용
- 수직적 확장: 노드에 더 많은 자원을 추가 

###### 2.2.4 분산 색인과 검색
- 색인 프로세스
  1. 색인 요청을 받은 노드가 문서를 색인할 샤드를 선택
     1. 문서는 샤드에 골고루 분산됨
     2. 각 문서에 대해 샤드는 그 문서의 ID 문자열을 해싱해서 결정
     3. 각 샤드는 동등하게 새로운 문서를 받을 기회와 함께 동등한 해시 범위를 가짐
  2. 대상 샤드가 결정되면 현재 노드는 샤드를 소유한 노드로 문서를 전달
  3. 레플리카 샤드에 다시 색인 
- 검색 프로세스
  1. 검색 시에 요청을 받은 노드는 모든 데이터를 포함한 샤드에 요청 전달
  2. RR(라운드 로빈)을 사용하여, 이용 가능한 주 혹은 레플리카 샤드를 선택하고 검색 요청을 전달
  3. 샤드들로부터 검색 결과를 집계 후에 응답 전달

#### 2.3 새로운 데이터 색인
(생략)