### 4장. 데이터 검색
- 엘라스틱서치의 검색 요청과 응답 구조
- 엘라스틱서치 필터 및 필터와 쿼리 차이점
- 필터 비트셋(Bitset)과 캐시(Caching)
- 엘라스틱서치가 제공하는 쿼리와 필터 사용하기

#### 4.1 검색 요청의 구조 
- 검색 요청
  - JSON 도큐먼트 기반 요청
  - URL 기반 요청 
###### 4.1.1 검색 범위 지정하기
- 일단 색인을 하면, 다중 색인을 검색하는 앨리어스(alias)도 사용할 수 있음 

###### 4.1.2 검색 요청의 기본 구성 요소
- 구성요소
  - 반환할 도큐먼트 개수 제어
  - 최적의 도큐먼트 선택
  - 원치 않는 도큐먼트는 거름

- query: 가장 중요한 구성 요소. 최적의 도큐먼트를 반환하거나 원치 않는 것을 거름. 
- size: 반환할 도큐먼트 갯수
- from: Pagination에 사용됨
- _source: 반환되는 필드를 결정할 수 있음 
- sort: 기본 정렬은 도큐먼트 점수 

###### 4.1.3 본문 기반 검색 요청 사용하기
- _source를 지정하지 않는다면, _source 전체를 반환하거나 메타데이터만 반환함 
  - 와일드카드를 사용할 수도 있음 

###### 4.1.4 응답 구조 이해하기 
(생략)

#### 4.2 쿼리와 필터 DSL 소개
- 필터와 쿼리의 차이점
- 기본 쿼리와 필터
- 고급 쿼리와 필터 및 복합 쿼리 
###### 4.2.1 쿼리와 텀 필터 일치 
- 필터는 점수를 매기지 않음 

###### 4.2.2 가장 많이 사용되는 기본 검색과 필터 
- MATCH_ALL 
  - 전체 도큐먼트 반환
  - 쿼리 대신 필터 사용이 필요할 때
  - 검색하는 색인과 타입 사이에서 모든 도큐먼트를 반환하고 싶을 때 
- MATCH
  - 특정 필드에 대해 일치하는 단어로 결과 제한
- QUERY_STRING
  - 가독성이 떨어짐 
  - 쿼리가 위력적인 힘을 가짐 
- 텀 쿼리와 텀 필터 
  - 텀을 포함하는 도큐먼트의 제한된 결과가 필요할 때 
- 텀즈 쿼리: 다중 텀으로 검색 
  - 최소 일치 수를 강제화하려면 minimum_should_match 사용 

###### 4.2.3 매치 쿼리와 텀 필터 
- 기본적으로 OR 연산
- phrase: 각 단어의 위치에 따른 특정 구를 검색할 때 

###### 4.2.4 Pharse_prefix 쿼리 
- 자동완성 제공에 유용함 
- 매치 쿼리는 어떠한 것도 검색할 수 있음 

#### 4.3 쿼리와 복합 쿼리 결합
###### 4.3.1 bool 쿼리
- bool 쿼리로 must 매치 지정하면, 오직 일치하는 결과만 받음
- should 매치 지정 -> 특정 갯수의 구문이 일치해야함5

###### 4.3.2 bool 필터 
- Bool 필터 , 쿼리와 동일한 역할 

#### 4.4 매치와 필터 쿼리를 넘어서서
###### 4.4.1 범위 쿼리와 필터
- 범위 쿼리를 사용하여 필드에 상위 및 하위 값 지정 

###### 4.4.2 프리픽스 쿼리와 필터 

###### 4.4.3 와일드카드 쿼리 
- ba*n: 다수의 문자
- ba?n: 하나의 문자 

#### 4.5 존재하는 필드에 필터로 쿼리
###### 4.5.1 Exists 필터
- 어떤 값이든 특정 필드에 값을 가지는 도큐먼트 쿼리
###### 4.5.2 Missing 필터
- 값이 없거나 기본값을 가진 도큐먼트 검색 
###### 4.5.3 쿼리를 필터로 변환

#### 4.6 실무를 위한 최선의 쿼리 선택

#### 4.7 요약
- match나 query_string과 같은 인간 언어 타입 쿼리는 검색창에 적합함
- 매치 쿼리는 전문 검색을 위한 쿼리이지만 query_string 쿼리는 루씬 쿼리 문법을 모두 노출하므로 더 유연하지만 더 복잡함
- match 쿼리는 boolean, phrase, phrase_prefix의 여러 서브 타입을 가짐
- 프리픽스와 와일드카드 쿼리 또한 지원함
- 존재하지 않는 필드가 있는 도큐먼트 필터링 시, missing 필터 사용
- exists는 정반대로 동작함 