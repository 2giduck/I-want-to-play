#### Chapter 2. 몽고DB 기본
몽고 DB 데이터의 기본 단위는 도큐먼트, RDBMS의 행과 유사함 (도큐먼트 == 행)

컬렉션(collection)은 동적 스키마가 있는 테이블과 같음 (컬렉션 == 테이블)

몽고DB의 단일 인스턴스는 자체적인 컬렉션을 갖는 여러 개의 독립적인 데이터베이스를 호스팅함

모든 도큐먼트는 컬렉션 내에서 고유한 특수키인 “_id”를 가짐

몽고 DB는 몽고 셸(mongo shell)이라는 도구와 함께 배포됨

몽고 셸(mongo shell)

몽고DB 인스턴스를 관리하고 몽고DB 쿼리 언어로 데이터를 조작하기 위한 내장 지원을 제공함

사용자가 다양한 목적으로 자신의 스크립트를 만들고 로드할 수 있는 자바스크립트 해석기

2.1 도큐먼트
도큐먼트의 키는 문자열, 예외를 제외하면 어떤 UTF-8 문자도 가능

예외) “\0”(null 문자), “.”, “$”

데이터형과 대소문자를 구별함
키는 중복될 수 없음
2.2 컬렉션
컬렉션: 도큐먼트의 모음

2.2.1 동적 스키마
컬렉션은 동적 스키마를 가짐

하나의 컬렉션 내 도큐먼트들이 모두 다른 구조를 가질 수 있음

// 다음 도큐먼트들을 하나의 컬렉션에 저장 가능
{ "greeting": "Hello, world!", "views": 3}
{ "signoff": "Good night, and good luck"}
같은 컬렉션에 다른 종류의 도큐먼트를 저장하면 개발자와 관리자에게 번거로움

블로그 게시물을 쿼리한 데이터 중 작성자 데이터만 제거하려면 상당히 번거롭다.

같은 종류의 데이터를 하나의 컬렉션에 모아두면 데이터 지역성(data locality)에 좋음

디스크 탐색 시간이 더 짧음

같은 유형의 도큐먼트를 하나의 컬렉션에 넣음으로써 컬렉션을 효율적으로 인덱싱 가능

2.2.2 네이밍
컬렉션은 이름으로 식별 됨

컬렉션 네이밍 제약 조건

상품서비스개발 > Chapter 1. 몽고DB 소개, Chapter 2. 몽고DB 기본 > 스크린샷 2023-08-01 오후 10.36.20.png
서브컬렉션
네임스페이스에 .(마침표) 문자를 사용해 컬렉션 체계화

ex. 블로그 기능이 있는 애플리케이션은 blog.posts와 blog.authors라는 컬렉션을 가질 수 있음

2.3 데이터베이스
몽고DB는 데이터베이스에 컬렉션을 그룹 지어 놓음

단일 인스턴스는 여러 데이터베이스를 호스팅할 수 있으며, 각 데이터베이스를 독립적으로 취급할 수 있음

한 애플리케이션의 데이터를 동일한 데이터베이스에 저장하는 것이 좋은 방식!

데이터베이스 이름 제약조건

상품서비스개발 > Chapter 1. 몽고DB 소개, Chapter 2. 몽고DB 기본 > 스크린샷 2023-08-01 오후 10.46.05.png
예약된 데이터베이스 이름

admin: 인증과 권한 부여 역할을 함

local: 단일 서버에 대한 데이터 저장

config: 각 샤드의 정보 저장

2.4 몽고DB 시작
유닉스 명령행 환경에서 mongod 실행 파일을 실행, 윈도우라면 mongod.exe

argument 없이 실행하면 기본 데이터 디렉터리로 /data/db를 사용

데이터 디렉터리가 존재하지 않거나 쓰기 권한이 없다면 서버가 실행되지 않음

몽고DB를 시작하기 전에 데이터 디렉터리를 생성하고 해당 디렉터리에 쓰기 권한이 있는지 확인

몽고DB는 기본적으로 27017번 포트에서 소켓 연결을 기다림

2.5 몽고DB 셸 소개
2.5.1 셸 실행
mongo를 실행해 셸을 시작함

javascript의 모든 기능을 활용할 수 있음

상품서비스개발 > Chapter 1. 몽고DB 소개, Chapter 2. 몽고DB 기본 > 스크린샷 2023-08-01 오후 10.52.30.png
2.5.2 몽고DB 클라이언트
셸은 시작할 때 몽고DB 서버의 test 데이터베이스에 연결하고, 데이터베이스 연결을 전역 변수 db에 할당함

주로 이 변수를 통해 몽고DB에 접근함

db 변수에서 컬렉션에 접근할 수 있음

상품서비스개발 > Chapter 1. 몽고DB 소개, Chapter 2. 몽고DB 기본 > 스크린샷 2023-08-01 오후 10.54.20.png
2.5.3 셸 기본 작업
생성

insertOne 함수는 컬렉션에 도큐먼트를 추가함

ex. movie라는 도큐먼트를 insertOne 함수를 사용해 movies 컬렉션에 저장

상품서비스개발 > Chapter 1. 몽고DB 소개, Chapter 2. 몽고DB 기본 > 스크린샷 2023-08-01 오후 10.56.10.png
읽기

find와 findOne을 사용해 컬렉션 쿼리

쿼리 도큐먼트 형태로 조건 전달도 가능함

셸은 find와 일치하는 도큐먼트를 20개까치 출력하지만, 그 이상도 가져올 수 있음

상품서비스개발 > Chapter 1. 몽고DB 소개, Chapter 2. 몽고DB 기본 > 스크린샷 2023-08-01 오후 10.57.25.png
갱신

updateOne을 사용해 도큐먼트 갱신

매개변수는 최소 두 개, 첫번째는 수정할 도큐먼트를 찾는 기준, 두 번째는 갱신 작업을 설명하는 도큐먼트

상품서비스개발 > Chapter 1. 몽고DB 소개, Chapter 2. 몽고DB 기본 > 스크린샷 2023-08-01 오후 10.59.00.png
삭제

deleteOne과 deleteMany는 도큐먼트를 데이터베이스에서 영구적으로 삭제함

필터 도큐먼트로 삭제 조건을 지정함

상품서비스개발 > Chapter 1. 몽고DB 소개, Chapter 2. 몽고DB 기본 > 스크린샷 2023-08-01 오후 11.00.11.png
2.6 데이터형
2.6.1 기본 데이터형
몽고DB는 JSON의 키/값 쌍 성질을 유지하면서 추가적인 데이터형을 지원함

기본 데이터형

null: 존재하지 않는 필드를 표현

불리언: 참과 거짓 값에 사용됨

숫자: 64bit 부동소수점 수를 기본으로 사용함

문자열

날짜: 1970년 1월 1일부터 시간을 1/1000초 단위로 나타내는 64bit 정수로 날짜를 저장함

{"x": new Date()}
정규 표현식: 자바스크립트의 정규 표현식 문법을 사용할 수 있음

{"x": /footbar/i}
배열: 값의 set이나 리스트를 배열로 표현

내장 도큐먼트

{ "x" : {"foo" : "bar"}}
객체 ID: 도큐먼트용 12바이트 ID

{ "x": ObjectId()}
이진 데이터

코드: 쿼리와 도큐먼트는 임의의 자바스크립트 코드를 포함할 수 있음

{"x": function() { /* ... */ }}
2.6.2 날짜
새로운 Date 객체를 생성할 때는 항상 Date()가 아닌 new Date()를 호출해야 함

new가 포함되지 않으면, 실제 Date 객체가 아닌 날짜의 문자열 표현을 반환함

몽고DB가 아니라 자바스크립트의 작동 방식 때문

2.6.3 배열
배열은 서로 다른 데이터형을 값으로 포함할 수 있음

{"things": ["pie", 3.14]}
중첩 배열도 가능함

배열 내부에 도달해서 원자적으로 배열의 내용을 수정할 수 있음

ex. pie의 값을 pi로

2.6.4 내장 도큐먼트
내장 도큐먼트: 도큐먼트가 키에 대한 값이 될 수 있음

상품서비스개발 > Chapter 1. 몽고DB 소개, Chapter 2. 몽고DB 기본 > 스크린샷 2023-08-01 오후 11.10.06.png
내장 도큐먼트를 적절히 사용하면 좀 더 자연스럽게 정보의 표현이 가능함

그러나 많은 데이터 반복(data repetition)이 생길 수 있음

2.6.5 _id와 ObjectId
모든 도큐먼트는 “_id” 키를 가짐

어떤 데이터형이어도 상관 없지만 , “ObjectId”가 기본

이 값은 컬렉션 내 모든 도큐먼트가 고유하게 식별되게 함

즉, 서로 다른 컬렉션 내에서는 동일한 “_id” 값의 도큐먼트를 가질 수 있음

도큐먼트를 입력할 때 “_id” 값을 명시하지 않으면 키가 자동으로 추가됨

ObjectIds

ObjectId를 사용하는 이유는 몽고Db의 분산 특성 때문

여러 서버에 걸쳐 자동으로 증가하는 기본 키를 동기화 하는 작업은 어렵고 시간이 걸림

상품서비스개발 > Chapter 1. 몽고DB 소개, Chapter 2. 몽고DB 기본 > 스크린샷 2023-08-01 오후 11.14.05.png
2.7 몽고DB 셸 사용
2.7.1 셸 활용 팁
help를 입력하면 셸에 내장된 도움말을 볼 수 있음

상품서비스개발 > Chapter 1. 몽고DB 소개, Chapter 2. 몽고DB 기본 > 스크린샷 2023-08-01 오후 11.15.54.png
함수의 기능을 알고 싶으면 함수명을 괄호 없이 입력

상품서비스개발 > Chapter 1. 몽고DB 소개, Chapter 2. 몽고DB 기본 > 스크린샷 2023-08-01 오후 11.16.18.png
2.7.2 셸에서 스크립트 실행하기
자바스크립트 파일을 셸로 전달해 실행할 수 있음, 명령행에 스크립트를 넘기면 됨

상품서비스개발 > Chapter 1. 몽고DB 소개, Chapter 2. 몽고DB 기본 > 스크린샷 2023-08-01 오후 11.17.13.png
2.7.3 .mongorc.js 만들기
자주 로드되는 스크립트를 .mongorc.js 파일에 넣을 수 있음

셸이 시작할 때마다 실행되는 스크립트

홈 디렉터리에 .mongorc.js 파일을 만들고 내용 추가

2.7.4 프롬프트 커스터마이징하기
(생략)

2.7.5 복잡한 변수 수정하기
(생략)
