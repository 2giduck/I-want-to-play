# Ch11. CQRS

## 11.1 단일 모델의 단점

---

- 시스템 상태를 변경할 때와 조회할 때 단일 도메인 모델을 사용하면 여러 애그리거트에서 데이터를 가져와 출력하는 기능을 구현하기에는 고려할 점이 많음
    - 상태 변경을 위한 모델과 조회를 위한 모델을 분리

## 11.2 CQRS

---

- 상태를 변경하는 범위와 상태를 조회하는 범위가 정확하게 일치하지 않기 때문에 단일 모델로 두 종류의 기능을 구현하면 모델이 불필요하게 복잡해짐 → CQRS!
- CQRS: Command Query Responsibility Segreations: 상태를 변경하는 명령(Command)를 위한 모델과 상태를 제공하는 조회(Query)를 위한 모델을 분리하는 패턴
    
    ![20240320231749.png](Ch11%20CQRS%20ca0f372bc4514b0bb0caf0bb2588809a/20240320231749.png)
    
    ![20240320231850.png](Ch11%20CQRS%20ca0f372bc4514b0bb0caf0bb2588809a/20240320231850.png)
    
- 명령 모델과 조회 모델이 서로 다른 데이터 저장소를 사용할 수도 있음
    - 명령 모델은 트랜잭션을 지원하는 RDBMS, 조회모델은 조회 성능이 좋은 메모리 기반 NoSQL 사용
    - 데이터동기화는 이벤트를 활용해서 처리함

### 11.2.1 웹과 CQRS

- 조회 성능을 높이기 위해 다양한 기법을 사용
    - 쿼리 최적화
    - 캐시
- 결과적으로 CQRS를 적용하는 것과 같은 효과를 만듦
    - 캐시 데이터는 DB 데이터를 저장하기보다는 화면에 맞는 모양으로 변환한 데이터를 캐싱할 때 성능에 더 유리함 → 즉, 조회 전용 모델을 캐시
    - 쿼리 최적화 → 조회 화면에 보여줄 데이터를 빠르게 읽어올 수 있도록 쿼리를 작성

### 11.2.1 CQRS 장단점

- 장점
    - 명령 모델을 구현할 때 도메인 자체에 집중할 수 있음
    - 조회 성능을 향상시키는 데 유리함
- 단점
    - 구현해야 할 코드가 더 많아짐 → 도메인이 단순하거나 트래픽이 많지 않다면 조회 전용 모델을 따로 만들 때 얻을 수 있는 이점이 있는지 따져봐야함
    - 더 많은 구현 기술이 필요함