# Ch2. 아키텍처 개요

최종 편집 일시: 2024년 1월 12일 오후 4:23
즐겨찾기: No
프로젝트: (book) 도메인 주도개발 시작하기  (https://www.notion.so/book-cb10f7efd53346d0b5cd32514b34471b?pvs=21)
상태: inbox

## 2.1 네개의 영역

- ‘표현’, ‘응용’, ‘도메인’, ‘인프라스트럭처’는 아키텍처를 설계할 때 출현하는 전형적인 네 가지 영역
- 표현 영역: 사용자의 **요청을 받아 응용 영역에 전달하고 응용 영역의 처리 결과를 다시 사용자에게 보여주는 역할**을 함
    
    ![스크린샷 2024-01-12 오후 3.32.16.png](Ch2%20%E1%84%8B%E1%85%A1%E1%84%8F%E1%85%B5%E1%84%90%E1%85%A6%E1%86%A8%E1%84%8E%E1%85%A5%20%E1%84%80%E1%85%A2%E1%84%8B%E1%85%AD%20dec9756e67814b9cb2e4212fc85f66ff/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2024-01-12_%25E1%2584%258B%25E1%2585%25A9%25E1%2584%2592%25E1%2585%25AE_3.32.16.png)
    

- 응용 영역: 시스템이 사용자에게 제공해야 할 기능을 구현
    - 주문 등록, 주문 취소, 상품 상세 조회 등
    - 기능을 구현하기 위해 도메인 영역의 도메인 모델을 사용
    - 로직을 직접 수행하기보다는 도메인 모델에 로직 수행을 위임함
        
        ![스크린샷 2024-01-12 오후 3.36.46.png](Ch2%20%E1%84%8B%E1%85%A1%E1%84%8F%E1%85%B5%E1%84%90%E1%85%A6%E1%86%A8%E1%84%8E%E1%85%A5%20%E1%84%80%E1%85%A2%E1%84%8B%E1%85%AD%20dec9756e67814b9cb2e4212fc85f66ff/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2024-01-12_%25E1%2584%258B%25E1%2585%25A9%25E1%2584%2592%25E1%2585%25AE_3.36.46.png)
        
- 도메인 영역: 도메인 모델을 구현
    - 도메인의 핵심 로직을 구현함
    - 배송지 변경, 결제 완료, 주문 총액 계산 등
- 인프라 스트럭처 영역: 구현 기술에 대한 것을 다룸
    - RDBMS 연동, MQ에 메시지 전송 및 수신 등
- 도메인, 응용, 표현 영역은 구현 기술을 사용한 코드를 직접 만들지 않고, 대신 인프라스트럭처 영역에서 제공하는 기능을 사용해 필요한 기능을 개발함

## 2.2 계층 구조 아키텍처

- 네 영역을 구성할 때 가장 많이 사용하는 아키텍처는 계층 구조
    
    ![스크린샷 2024-01-12 오후 3.39.54.png](Ch2%20%E1%84%8B%E1%85%A1%E1%84%8F%E1%85%B5%E1%84%90%E1%85%A6%E1%86%A8%E1%84%8E%E1%85%A5%20%E1%84%80%E1%85%A2%E1%84%8B%E1%85%AD%20dec9756e67814b9cb2e4212fc85f66ff/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2024-01-12_%25E1%2584%258B%25E1%2585%25A9%25E1%2584%2592%25E1%2585%25AE_3.39.54.png)
    
- 그 특성상 상위 계층에서 하위 계층으로의 의존만 존재하고 하위 계층은 상위 계층에 의존하지 않는다
- 엄격하게 적용하면 상위 계층은 바로 아래 계층에만 의존을 가져야 함
    - 그렇지만 구현의 편리함을 위해 유연하게 적용하기도 함

![스크린샷 2024-01-12 오후 3.44.30.png](Ch2%20%E1%84%8B%E1%85%A1%E1%84%8F%E1%85%B5%E1%84%90%E1%85%A6%E1%86%A8%E1%84%8E%E1%85%A5%20%E1%84%80%E1%85%A2%E1%84%8B%E1%85%AD%20dec9756e67814b9cb2e4212fc85f66ff/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2024-01-12_%25E1%2584%258B%25E1%2585%25A9%25E1%2584%2592%25E1%2585%25AE_3.44.30.png)

- 위의 구조를 사용하면 인프라스트럭처 계층에 의존하게 되어 문제가 발생함

![스크린샷 2024-01-12 오후 3.44.56.png](Ch2%20%E1%84%8B%E1%85%A1%E1%84%8F%E1%85%B5%E1%84%90%E1%85%A6%E1%86%A8%E1%84%8E%E1%85%A5%20%E1%84%80%E1%85%A2%E1%84%8B%E1%85%AD%20dec9756e67814b9cb2e4212fc85f66ff/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2024-01-12_%25E1%2584%258B%25E1%2585%25A9%25E1%2584%2592%25E1%2585%25AE_3.44.56.png)

- 테스트 어려움
- 기능 확장의 어려움

## 2.3 DIP

![스크린샷 2024-01-12 오후 3.48.27.png](Ch2%20%E1%84%8B%E1%85%A1%E1%84%8F%E1%85%B5%E1%84%90%E1%85%A6%E1%86%A8%E1%84%8E%E1%85%A5%20%E1%84%80%E1%85%A2%E1%84%8B%E1%85%AD%20dec9756e67814b9cb2e4212fc85f66ff/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2024-01-12_%25E1%2584%258B%25E1%2585%25A9%25E1%2584%2592%25E1%2585%25AE_3.48.27.png)

- 고수준 모듈이 제대로 동작하려면 저수준 모듈을 사용해야 함
- 그러나 고수준 모듈이 저수준 모듈을 사용하면 구현 변경과 테스트가 어렵다는 두가지 문제가 발생
- 이를 해결하기 위해서 “추상화한 인터페이스”를 이용하여 DIP(Dependency Inversion Principle) 적용

![스크린샷 2024-01-12 오후 3.51.10.png](Ch2%20%E1%84%8B%E1%85%A1%E1%84%8F%E1%85%B5%E1%84%90%E1%85%A6%E1%86%A8%E1%84%8E%E1%85%A5%20%E1%84%80%E1%85%A2%E1%84%8B%E1%85%AD%20dec9756e67814b9cb2e4212fc85f66ff/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2024-01-12_%25E1%2584%258B%25E1%2585%25A9%25E1%2584%2592%25E1%2585%25AE_3.51.10.png)

![스크린샷 2024-01-12 오후 3.52.03.png](Ch2%20%E1%84%8B%E1%85%A1%E1%84%8F%E1%85%B5%E1%84%90%E1%85%A6%E1%86%A8%E1%84%8E%E1%85%A5%20%E1%84%80%E1%85%A2%E1%84%8B%E1%85%AD%20dec9756e67814b9cb2e4212fc85f66ff/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2024-01-12_%25E1%2584%258B%25E1%2585%25A9%25E1%2584%2592%25E1%2585%25AE_3.52.03.png)

- DIP를 이용하여 구현 변경과 테스트 어려움 문제를 동시에 해결할 수 있음

### 2.3.1 DIP 주의사항

- DIP를 잘못 이해하면 단순히 인터페이스와 구현 클래스를 분리하는 정도로 받아들일 수 있음

![스크린샷 2024-01-12 오후 3.56.41.png](Ch2%20%E1%84%8B%E1%85%A1%E1%84%8F%E1%85%B5%E1%84%90%E1%85%A6%E1%86%A8%E1%84%8E%E1%85%A5%20%E1%84%80%E1%85%A2%E1%84%8B%E1%85%AD%20dec9756e67814b9cb2e4212fc85f66ff/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2024-01-12_%25E1%2584%258B%25E1%2585%25A9%25E1%2584%2592%25E1%2585%25AE_3.56.41.png)

- 잘못된 점: RuleEngine 인터페이스가 고수준 모듈인 도메인 관점이 아닌 룰 엔진이라는 저수준 모듈 관점에서 도출됨
- DIP를 적용할 때 하위 기능을 추상화한 인터페이스는 고수준 모듈 관점에서 도출해야 함
    
    ![스크린샷 2024-01-12 오후 3.58.27.png](Ch2%20%E1%84%8B%E1%85%A1%E1%84%8F%E1%85%B5%E1%84%90%E1%85%A6%E1%86%A8%E1%84%8E%E1%85%A5%20%E1%84%80%E1%85%A2%E1%84%8B%E1%85%AD%20dec9756e67814b9cb2e4212fc85f66ff/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2024-01-12_%25E1%2584%258B%25E1%2585%25A9%25E1%2584%2592%25E1%2585%25AE_3.58.27.png)
    

### 2.3.2 DIP와 아키텍처

- 인프라스트럭처 영역은 구현 기술을 다루는 저수준 모듈이고 응용 영역과 도메인 영역은 고수준 모듈
- 아키텍처에서 DIP를 적용하면 인프라스트럭처 영역이 응용 영역과 도메인 영역에 의존하는 구조가 됨
    
    ![스크린샷 2024-01-12 오후 4.00.09.png](Ch2%20%E1%84%8B%E1%85%A1%E1%84%8F%E1%85%B5%E1%84%90%E1%85%A6%E1%86%A8%E1%84%8E%E1%85%A5%20%E1%84%80%E1%85%A2%E1%84%8B%E1%85%AD%20dec9756e67814b9cb2e4212fc85f66ff/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2024-01-12_%25E1%2584%258B%25E1%2585%25A9%25E1%2584%2592%25E1%2585%25AE_4.00.09.png)
    

- 다만, DIP를 항상 적용할 필요는 없음
    - 사용하는 기술에 따라 DIP보다 구현 기술에 의존적인 코드를 도메인에 일부 포함하는게 더 효과적일 때도 있음

## 2.4 도메인 영역의 주요 구성요소

- 도메인 영역의 주요 구성요소
    
    ![스크린샷 2024-01-12 오후 4.02.26.png](Ch2%20%E1%84%8B%E1%85%A1%E1%84%8F%E1%85%B5%E1%84%90%E1%85%A6%E1%86%A8%E1%84%8E%E1%85%A5%20%E1%84%80%E1%85%A2%E1%84%8B%E1%85%AD%20dec9756e67814b9cb2e4212fc85f66ff/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2024-01-12_%25E1%2584%258B%25E1%2585%25A9%25E1%2584%2592%25E1%2585%25AE_4.02.26.png)
    

### 2.4.1 엔티티와 밸류

- 필자는 개발 초년 시절에 `DB 테이블 엔티티 == 도메인 모델 엔티티` 라고 생각함
- 가장 큰 차이점은 도메인 모델 엔티티는 데이터와 함께 도메인 기능을 함께 제공한다는 점
- 또 다른 차이점은 도메인 모델 엔티티는 두 개 이상의 데이터가 개념적으로 하나인 경우 밸류 타입을 이용해서 표현할 수 있음
    - RDBMS는 밸류 타입을 제대로 표현하기가 힘듦

### 2.4.2 애그리거트

- 도메인이 커질수록 많은 엔티티와 밸류가 출현
- 도메인 모델을 개별 객체 뿐만 아니라 상위 수준에서 모델을 볼 수 있어야 전체 모델의 관계와 개별 모델을 이해하는 데 도움이 됨
- 애그리거트(AGGREGATE): 관련 객체를 하나로 묶은 군집
    - 주문 (AGGREGATE)
        - 주문
        - 배송지 정보
        - 주문자
        - 주문 목록
- 애그리거트를 사용하면 개별 객체가 아닌 관련 객체를 묶어서 객체 군집 단위로 모델을 바라볼 수 있게 됨
- 애그리거트는 군집에 속한 객체를 관리하는 루트 엔티티를 가짐
    - 루트 엔티티: 애그리거트에 속해 있는 엔티티와 밸류 객체를 이용해 애그리거트가 구현해야 할 기능을 제공
    - 애그리거트를 사용하는 코드는 애그리거트 루트가 제공하는 기능을 실행하고 애그리거트 루트를 통해 간접적으로 애그리거트 내의 다른 엔티티나 밸류 객체에 접근 ⇒ 캡슐화
        
        ![스크린샷 2024-01-12 오후 4.09.55.png](Ch2%20%E1%84%8B%E1%85%A1%E1%84%8F%E1%85%B5%E1%84%90%E1%85%A6%E1%86%A8%E1%84%8E%E1%85%A5%20%E1%84%80%E1%85%A2%E1%84%8B%E1%85%AD%20dec9756e67814b9cb2e4212fc85f66ff/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2024-01-12_%25E1%2584%258B%25E1%2585%25A9%25E1%2584%2592%25E1%2585%25AE_4.09.55.png)
        

### 2.4.3 리포지터리

- 리포지터리(Repository): 구현을 위한 도메인 모델
    - 애그리거트 단위로 도메인 객체를 저장하고 조회하는 기능을 정의
- 도메인 모델 관점에서 리포지터리는 도메인 객체를 영속화하는 데 필요한 기능을 추상화한 것 으로 고수준 모듈에 속함
    
    ![스크린샷 2024-01-12 오후 4.13.12.png](Ch2%20%E1%84%8B%E1%85%A1%E1%84%8F%E1%85%B5%E1%84%90%E1%85%A6%E1%86%A8%E1%84%8E%E1%85%A5%20%E1%84%80%E1%85%A2%E1%84%8B%E1%85%AD%20dec9756e67814b9cb2e4212fc85f66ff/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2024-01-12_%25E1%2584%258B%25E1%2585%25A9%25E1%2584%2592%25E1%2585%25AE_4.13.12.png)
    
- 응용 서비스는 의존 주입과 같은 방식을 사용해 실제 리포지터리 구현 객체에 접근함

## 2.5 요청 처리 흐름

![스크린샷 2024-01-12 오후 4.18.09.png](Ch2%20%E1%84%8B%E1%85%A1%E1%84%8F%E1%85%B5%E1%84%90%E1%85%A6%E1%86%A8%E1%84%8E%E1%85%A5%20%E1%84%80%E1%85%A2%E1%84%8B%E1%85%AD%20dec9756e67814b9cb2e4212fc85f66ff/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2024-01-12_%25E1%2584%258B%25E1%2585%25A9%25E1%2584%2592%25E1%2585%25AE_4.18.09.png)

## 2.6 인프라스트럭처 개요

- 인프라스트럭처는 표현 영역, 응용 영역, 도메인 영역을 지원함
- 무조건 인프라스트럭처에 대한 의존을 없앨 필요는 없음
    - ex. @Transactional사용

## 2.7 모듈 구성

- 영역별로 모듈이 위치할 패키지를 구성할 수 있음
    
    ![스크린샷 2024-01-12 오후 4.21.08.png](Ch2%20%E1%84%8B%E1%85%A1%E1%84%8F%E1%85%B5%E1%84%90%E1%85%A6%E1%86%A8%E1%84%8E%E1%85%A5%20%E1%84%80%E1%85%A2%E1%84%8B%E1%85%AD%20dec9756e67814b9cb2e4212fc85f66ff/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2024-01-12_%25E1%2584%258B%25E1%2585%25A9%25E1%2584%2592%25E1%2585%25AE_4.21.08.png)
    
- 도메인 모듈은 도메인에 속한 애그리거트를 기준으로 다시 패키지를 구성함
    
    ![스크린샷 2024-01-12 오후 4.21.36.png](Ch2%20%E1%84%8B%E1%85%A1%E1%84%8F%E1%85%B5%E1%84%90%E1%85%A6%E1%86%A8%E1%84%8E%E1%85%A5%20%E1%84%80%E1%85%A2%E1%84%8B%E1%85%AD%20dec9756e67814b9cb2e4212fc85f66ff/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2024-01-12_%25E1%2584%258B%25E1%2585%25A9%25E1%2584%2592%25E1%2585%25AE_4.21.36.png)
    
- 도메인이 복잡하면 도메인 모델과 도메인 서비스를 별도 패키지에 위치시킬 수 있음
    - `com.myshop.order.domain.order`: 애그리거트 위치
    - `com.myshop.order.domain.service`: 도메인 서비스 위치
- 응용 서비스도 도메인 별로 패키지를 구분할 수 있음
    - `com.myshop.catalog.application.product`
    - `com.myshop.catalog.application.category`