# Ch5. 스프링 데이터 JPA를 이용한 조회 기능

## 5.1 시작에 앞서

- CQRS
    - 명령(command) 모델과 조회(Query) 모델을 분리하는 패턴
- 명령 모델: 상태를 변경하는 기능을 구현할 때 사용
- 조회 모델: 데이터를 조회하는 기능을 구현할 때 사용

## 5.2 검색을 위한 스펙

- 스펙: 애그리거트가 특정 조건을 충족하는지 검사할 때 사용하는 인터페이스
- 리포지터리나 DAO는 검색 대상을 걸러내는 용도로 스펙을 사용

## 5.3 스프링 데이터 JPA를 이용한 스펙 구현

- 스프링 데이터 JPA는 검색 조건을 표현하기 위한 인터페이스인 Specification을 제공
    - toPredicate() 메서드는 JPA 크리테리아 API에서 조건을 표현하는 Predicate 생성

## 5.4 리포지터리/DAO에서 스펙 사용하기

- 스펙을 충족하는 엔티티를 검색하고 싶다면 findAll() 메소드를 사용

## 5.5 스펙 조합

- 스펙 인터페이스는 스펙을 조합할 수 잇는 두 메서드를 제공
    - and
    - or
    - not: 정적 메서드로 조건을 반대로 적용
    - where: null 가능성이 있는 객체에서 null이라면 아무 조건도 생성하지 않는 스펙 객체 리턴

## 5.6 정렬 지정하기

- 스프링 데이터 JPA의 정렬 방법
    - 메서드 이름에 orderBy
        - 간편하지만 프로퍼티가 두 개 이상이면 메서드 이름이 길어짐
    - Sort를 인자로 전달

## 5.7 페이징 처리하기

- 스프링 데이터 JPA는 페이징 처리를 위해 Pageable 타입을 이용
- PageRequest.of() 메서드의 첫 번째 인자는 페이지 번호, 두 번째 인자는 한 페이지의 개수
- Page 타입을 이용하면 데이터 목록뿐만 아니라 조건에 해당하는 전체 개수도 구할 수 있음

## 5.8 스펙 조합을 위한 스펙 빌더 클래스

- 스펙 빌더
- (코드 생략)

## 5.9 동적 인스턴스 생성

- JPA는 쿼리 결과에서 임의의 객체를 동적으로 생성할 수 있는 기능을 제공
- 조회 전용 모델을 만드는 이유는 표현 영역을 통해 사용자에게 데이터를 보여주기 위함

## 5.10 하이버네이트 @Subselect 사용

- 하이버네이트는 JPA 확장 기능으로 @Subselect를 제공
    - 쿼리 결과를 @Entity로 매핑할 수 있는 유용한 기능
- @Subselect는 조회 쿼리를 값으로 갖음
- @Immutable을 사용하면 하이버네이트는 해당 엔티티의 매핑 필드/프로퍼티가 변경되도 DB에 반영하지 않고 무시함
- @Synchronize는 해당 엔티티와 관련된 테이블 목록을 명시함