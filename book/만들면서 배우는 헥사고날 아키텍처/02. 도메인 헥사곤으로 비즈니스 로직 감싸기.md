### 02. 도메인 헥사곤으로 비즈니스 규칙 감싸기
- 1장에서는 헥사고날 아키텍처의 첫 번째 헥사곤인 도메인 헥사곤에 대해 배움
- 도메인 헥사곤: 가장 내부에 있는 헥사곤이므로 그 위의 어떤 헥사곤에도 의존하지 않음
- 다른 모든 헥사곤은 도메인 헥사곤에 의존함
- 이번 장에서 다룰 내용
  - 엔티티를 통한 문제 영역 모델링
  - 값 객체를 통한 서술성 향상
  - 애그리게잇(aggregate)을 통한 일관성 보장
  - 도메인 서비스 활용
  - 정책 및 명세 패턴을 활용한 비즈니스 규칙 처리
  - POJO(Plain Old Java Object)를 이용한 비즈니스 규칙 정의

#### 엔티티를 활용한 문제 영역 모델링
- DDD에서는 코드를 작성하기 전에 개발자와 비즈니스를 깊게 이해하는 도메인 전문가 사이에서 많은 논의 필요
  - 지식 크런칭: 개발자와 도메인 전문가 사이의 브레인스토밍
  - 해당 지식은 보편 언어를 통해 통합
- 엔티티를 엔티티로 간주하려면, 엔티티가 식별자를 가져야 함
###### 도메인 엔티티의 순수성
- 문제 영역을 모델링할 때의 초점은 가능한 한 정확하게 실제 시나리오 → 코드 변환
- 문제 영역 모델링의 핵심은 엔티티를 만드는 것
- 비즈니스 관련 코드와 기술 관련 코드가 혼동되는 것을 방지하기 위해 노력해야 함
- 기술적: 소프트웨어 맥락에서만 존재하고 의미가 있는 것
- 도메인 엔티티는 비즈니스 관심사만 처리한다는 점에서 순수해야 함
###### 관련 엔티티 
- 비즈니스 규칙과 비즈니스 데이터라는 두 요소의 존재는 관련 엔티티의 특징을 결정함
  - 데이터 부분만 표현하고 규칙을 무시하는 엔티티 → 빈약한 도메인 모델(데이터는 있지만 특징은 부족)
  - 빈약한 도메인 모델을 사용하면, 엔티티가 무엇을 해야하는지 파악하기 위해 다른 곳으로 가야함
- 반면, 모델링하는 엔티티에 본질적이지 않은 로직으로 엔티티 클래스에 과부하를 줘서는 안 됨
###### UUID를 통한 식별자 정의
- 식별자를 DB 시퀀스 매커니즘에 의존하는 기법을 사용한 적이 많을 것
- 기술 의존성이 적은 헥사고날 애플리케이션 개발 목적이라면 식별자 생성을 독립적인 프로세스로 전환해야 함
- 가장 보편적인 방법은 범용적 고유 식별자, UUID를 사용하는 것
- 그러나 UUID는 문자열이기 때문에 RDBMS에서 자동으로 생성해주는 정수보다 더 많은 메모리를 소비함
- 각각 장단점이 있으니 잘 선택할 것
- 엔티티는 헥사고날 아키텍처의 일급 객체
- 그러나 도메인의 모든 것이 ID를 갖는 것이 아니기 때문에 엔티티만으로 풍부한 도메인 모델을 생성하기에는 역부족
- 그래서 고유하게 식별할 필요가 없는 값 객체를 사용함

#### 값 객체를 통한 서술력 향상
- 문제 영역에서 사물을 측정하고, 수량화하거나 서술하기 위해 값 객체를 사용해야 함 by 도메인 주도 설계 구현
- 값 객체의 기본 특성
  - 값 객체는 불변이다
  - 값 객체는 식별자를 가지지 않는다
- 엔티티는 그림, 값 객체는 물감이라고 표현함
- 결론은, 값 객체는 폐기할 수 있어야 하고 엔티티나 다른 객체 타입을 구성하는 데 사용할 수 있는 쉽게 교체 가능한 객체여야 함

#### 애그리게잇을 통한 일관성 보장
- 애그리게잇: 관련 엔티티와 값 객체의 그룹이 함께 전체적인 개념을 설명하기 위 해 사용
- 애그리게잇 내부의 객체들은 일관되고 격리된 방식으로 동작함
- 애그리게잇은 객체의 데이터와 동작을 조정하는 오케스트레이터와 같음
- 애그리게잇과 상호작용할 진입점(애그리게잇 루트)을 잘 정의해야 함
- 항상 애그리게잇을 가능한 한 작게 유지하도록 노력해야함
  - 너무 많은 애그리게잇 객체를 인스턴스로 만들면 JVM의 전반적인 성능이 저하될 수 있음

#### 도메인 서비스 활용
- 서비스란? 무언가 가치있는 활동을 수행하는 능력
- 컴퓨터의 서비스는 훌륭한 아키텍처를 위해 관심사의 분리, 모듈화, 디커플링 등에 관심을 가져야 함
- 도메인 서비스는 다른 서비스와 마찬가지로 가치있는 작업을 수행하지만, 문제 영역의 제한된 범위 내에서만 수행함
  - 도메인 서비스는 애플리케이션 헥사곤이나 프레임워크 헥사곤에서 동작하는 서비스나 다른 객체를 호출해서는 안됨

#### 정책 패턴과 명세 패턴을 활용한 비즈니스 규칙 처리
- 비즈니스 요구사항을 이해하고 그것을 소프트웨어로 변환하는 과정은 애자일 선언문을 탄생시킨 매우 훌륭한 토론의 결과물
- 비즈니스 규칙을 더 잘 구조화 하기 위한 두 가지 패턴
1. 정책 패턴
- 코드 블록으로 문제 영역의 일부를 캡슐화 하는 패턴
- 제공된 데이터에 대해 어떤 작업이나 처리를 함
- 커플링을 피하기 위해 의도적으로 엔티티와 값 객체를 분리해 유지함
2. 명세 패턴
- 객체의 특성을 보장하는 데 사용되는 조건이나 프레디케이트와 같음
- 단순한 논리적인 연산자보다는 더 표현적인 방법으로 프레디케이트를 캡슐화
- 명세는 정책에 적합한 개체만 처리하는 것을 보장함

#### POJO를 통한 비즈니스 규칙 정의 
- POJO는 일반적인 자바 객체에 불과하기 때문에 매력적임
- 자바 표준 API에서만 다루기 때문에 이해하기 쉬움
- 애플리케이션의 여러 부분에서 이해하고 재사용하기 쉬움
- 변경을 허용할 수 있는 애플리케이션을 목표로 한다면, 특정 기술과의 결합을 줄이기 위해 항상 POJO의 사용이 권장됨
- POJO를 사용해 비즈니스 규칙도 나타낼 수 있음 