### 06. 클러스터 운영 

#### 6.1 클러스터 설정 API
- 클러스터 설정 API는 클러스터와 관련된 설정을 확인 및 변경 
- persistent: 클러스터를 풀 리스타트로 재시작해도 유지됨
- transient: 클러스터를 전체 재시작하면 사라짐 
- 우선순위 transient > persistent > config/elasticsearch.yml

#### 6.2 cat API를 통한 클러스터 관리와 모니터링
- cat API: 엘라스틱서치의 여러 현재 상태를 조회
- cat: compact and aligned text
- v 매개변수를 추가로 주면 응답에 각 칼럼의 제목이 포함됨 

#### 6.3 인덱스 운영 전략
###### 6.3.1 템플릿과 명시적 매핑 활용
- 최대한 명시적으로 매핑 지정
###### 6.3.2 라우팅 활용
###### 6.3.3 시계열 인덱스 이름
- 시계열 데이터를 색인하면 인덱스 이름에도 시간값을 넣는 방법을 고려 
###### 6.3.4 alias
- alias는 이미 존재하는 인덱스를 다른 이름으로도 가리키도록 하는 기능 
- 새 인덱스를 만들고 alias가 가리키는 인덱스만 변경 
###### 6.3.5 롤오버 
- 다양한 지정 조건에 도달하면 엘라스틱서치가 자동으로 롤오버를 수행하도록 지정 가능
###### 6.3.6 데이터 스트림
- 데이터 스트림은 내부적으로 여러 개의 인덱스로 구성됨 
- 인덱스 템플릿과 연계해 조금 더 시계열 데이터 사용 패턴에 맞게 정형화하고 간단하게 사용하게 한 것 
###### 6.3.7 reindex
- 원본 인덱스 내의 문서의 _source를 읽어서 대상 인덱스에 새로 색인하는 작업 
- reindex는 작업 특성상 매핑에서 _source가 활성화되어 있어야 한다 
###### 6.3.8 shrink로 샤드 개수 줄이기
- 샤드 개수를 줄이면서 인덱스를 새로 생성하는 작업 
###### 6.3.9 split으로 샤드 개수 늘리기
- 샤드의 개수를 늘리면서 인덱스를 새로 생성하는 작업 
###### 6.3.10 다중 필드 
- 운영 도중 다중 필드를 추가할 수 있음 
- 기존 데이터는 다시 색인을 해야 추가된 다중 필드가 적용됨
###### 6.3.11 타입이 계속 변경되는 데이터
- 매핑에서 타입을 object로 지정한 뒤 enabled: false로 지정 
###### 6.3.12 루씬 텀 길이 제약
- ignore_above는 지정한 수치보다 긴 텀을 역색인에 넣지 않도록 해주는 속성 
###### 6.3.13 대량 색인이 필요할 때 

#### 6.4 샤드 운영 전략
###### 6.4.1 샤드의 크기와 개수 조정
- 샤드 하나의 크기를 일정 기준 이하로 유지해야 함, 당 20~40GB가 적당
###### 6.4.2 모든 노드가 충분히 일을 하고 잇는지 
###### 6.4.3 미래에 데이터가 커질 것을 고려
###### 6.4.4 테스트 수행
- 실제 서비스 조건과 유사한 조건으로 테스트를 수행하고 그 결과를 참고해 개수를 지정하자 

#### 6.5 롤링 리스타트
- flush를 수행해서 translog를 비우고 데이터를 디스크에 안전하게 기록 
- 샤드 할당을 비활성화하고 flush를 완료후 노드 재기동
- 샤드 할당을 다시 활성화 

#### 6.6 스냅샷과 복구
- 스냅샷: 동작 중인 엘라스틱서치 클러스터의 인덱스를 백업하는 방법
###### 6.6.1 스냅샷 저장소 등록과 설정
###### 6.6.2 스냅샷을 생성하고 조회하기 
###### 6.6.3 스냅샷에서 인덱스 복구하기
- 메이저 버전이 둘 이상 차이나면 하위 호환을 지원하지 않음 
###### 6.6.4 스냅샷 삭제
- 주기적으로 스냅샷을 삭제하며 관리해 주어야 함
###### 6.6.5 스냅샷 생명 주기 관리
- 지정한 시각에 지정한 스냅샷을 찍고 지정한 기간보다 오래된 스냅샷은 삭제 

#### 6.7 명시적으로 세그먼트 병합하기
- 세그먼트 병합을 수행한 이후에는 검색 성능의 향상, 자원 절약을 기대할 수 있음

#### 6.8 샤드 할당 필터링과 데이터 티어 구조
###### 6.8.1 노드 속성과 샤드 할당 의식 
###### 6.8.2 클러스터 단위 샤드 할당 필터링
###### 6.8.3 인덱스 단위 샤드 할당 필터링
###### 6.8.4 데이터 티어 구조

#### 6.9 인덱스 생명 주기 관리 
- 인덱스를 hot-warm-cold-frozen-delete로 구분해서 지정한 기간이 지나면 다음 페이즈로 전환 

#### 6.10 서킷 브레이커
- 문제를 발생시킬만한 무거운 작업의 수행을 사전 차단 

#### 6.11 슬로우 로그 설정
- 장애 원인을 추적하는 데 매우 도움이 됨 
- 어떤 인덱스, 어떤 샤드에서 어떤 쿼리가 얼마나 시간을 소요했는지 알 수 있음 

#### 6.12 버전 업그레이드 
- 롤링 업그레이드: 노드를 한 대씩 리스타트하는 과정에서 종료한 노드의 버전을 올려 재기동 
- 풀 리스타트 업그레이드: 클러스터 완전 종료후 전체 노드 버전을 업데이트한 뒤 새로 일괄 기동 