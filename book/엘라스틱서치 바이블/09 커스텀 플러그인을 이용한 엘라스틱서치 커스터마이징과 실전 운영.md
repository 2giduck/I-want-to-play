# 09. 커스텀 플러그인을 이용한 엘라스틱서치 커스터마이징과 실전 운영

## 9.1 커스텀 플러그인이 필요한 이유

- 엘라스틱서치은 플러그인을 통해 많은 부분을 세세하게 커스터마이징 할 수 있도록 설계됐다.

## 9.2 플러그인 기본

### 9.2.1 플러그인 기본 관리

- 직접 만든 커스텀 플러그인을 설치하려면 경로를 직접 지정해야 함

### 9.2.2 플러그인 기본 구조

- 플러그인이 설치되면 plugins/[플러그인 이름] 디렉터리가 생성되며 여기에 플러그인 파일의 내용물이 들어간다.
- 플러그인 클래스는 Plugin 추상 클래스를 확장한 뒤 필요한 주요 메서드를 오버라이드 하여 작성한다.

### 9.2.3 플러그인 개발 시 유의할 사항

- 엘라스틱서치 플러그인은 동작할 엘라스틱서치 버전을 명확히 지정해야 한다.
- 플러그인 개발 자체는 엘라스틱 라이선스를 위반하지 않으며 파생 작업을 구성하지도 않는다.

## 9.3 Hello World 플러그인 제작

### 9.3.1 플러그인 프로젝트 생성과 기본 구조 잡기

### 9.3.2 Plugin과 ActionPlugin

- 플러그인이 엘라스틱서치의 설정에 접근하려면 Plugin 클래스의 getSettings를 오버라이드 해야 한다.
- ActionRequest는 액션의 요청을 정의하는 추상 클래스다.
- ActionResponse는 액션의 수행 결과를 담아 클라이언트에게 돌려줄 응답을 정의하는 추상 클래스다.
- ActionType은 액션의 종류를 명시하는 클래스다.
- TransportAcion에는 실제로 액션이 실행될 때 수행해야 할 동작을 구현한다.
- RestHandler는 작성한 액션을 엘라스틱서치 REST API에 등록시키는 역할을 수행한다.

## 9.4 엘라스틱서치와 플러그인의 테스트 코드 작성

### 9.4.1 테스트 코드 작성을 위한 기본 설정

### 9.4.2 엘라스틱서치 테스트 프레임워크로 테스트 코드 작성

- 엘라스틱서치 테스트 코드는 ESTestCase 추상 클래스에서 출발한다.
- ESSingleNodeTestCase는 테스트 코드 내에서 엘라스틱서치 노드 하나를 띄워서 구글 주소로 관리되는 엘라스틱서치 내의 여러 인스턴스에 접근할 수 있도록 한다.
- ESIntegTestCase는 테스트 코드 내에서 엘라스틱서치 클러스터를 기동하고 그 안에서 통합 테스트를 수행할 수 있도록 한다.

### 9.4.3 REST 레이어 테스트

- ESRestTestCase는 ESTestCase를 확장해 작성된 추상 클래스로 테스트 코드 내에서 RestClient를 쉽게 끌어 쓸 수 있도록 돕는다.