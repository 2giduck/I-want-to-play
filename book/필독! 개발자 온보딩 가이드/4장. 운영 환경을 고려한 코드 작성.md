
### 4장. 운영 환경을 고려한 코드 작성

##### 장애에 대비하기 위한 방어적 프로그래밍 방안
###### null 값 사용은 피하자
- 널 객체 패턴: 널 값 대신에 객체를 사용하는 패턴
- 옵션 타입 활용
###### 불변 변수를 사용하자
- 불변 변수는 값이 대입되고 나면 그 값을 바꿀 수 없음
###### 타입 힌트와 정적 타입 검사를 사용하자
###### 입력값을 검사하자
###### 예외를 활용하자
###### 예외는 구체적으로 사용하자
###### 예외는 일찍 던지고 최대한 나중에 처리하자
###### 재시도는 현명하게
- backoff 전략 사용
###### 시스템에 멱등성을 부여하자
###### 리소스를 해제하자

##### 문제 원인을 찾기 위한 로깅 방안
- 스레드 이름, 호스트 이름, ID등과 같은 컨텍스트 정보 주입
###### 로그 레벨을 사용하자
###### 로그는 원자적으로 작성하자
- 로그 메시지에 줄바꿈 문자 사용을 피하자
###### 로그는 신속하게 기록하자
###### 민감한 데이터는 로그에 기록하지 말자

##### 애플리케이션 동작 측정을 위한 지표 활용 방안
- 카운터: 특정 이벤트가 밥ㄹ생한 횟수를 측정함
- 게이지: 특정 시점을 기준으로 측정함
- 히스토그램: 규모에 따라 이벤트를 특정 범위로 구분함
###### 표준 지표 라이브러리를 사용하자
###### 모든 것을 측정하자
- 리소스 풀
- 캐시
- 데이터 구조
- CPU 집약적 작업
- IO 집약적 작업
- 데이터 크기
- 예외와 에러
- 원격 요청 및 응답

##### 오늘날 분산 환경에서 더욱 중요해진 추적
- 분산 호출 추적: 다운스트림 호출을 한데 모아 하나의 그래프로 만들어 줌

##### 설정으로 런타임 동작을 손쉽게 조정하려면
###### 지나치게 창의적인 설정은 금물이다
###### 모든 설정을 로그에 기록하고 검증하자
###### 기본값을 제공하자
###### 관련된 설정을 그룹화하자
###### 설정도 코드처럼 테스트하자
###### 설정 파일은 깔끔하게 유지하자
###### 배포된 설정은 변경하지 말자

##### 때로는 도구가 운영의 성패를 결정짓기도 한다

##### 개발자의 필수 체크리스트
- 런타임에러보다는 컴파일 타임에 에러를 검출하자
- 가능하면 불변 변수를 사용하자
- 입력과 출력을 검증하자
- 버그 확인 도구는 물론 타입 또는 타입 힌트도 사용하자
- 예외 발생 시에는 리소스를 해제하자
- 코드에 지표를 추가하자
- 애플리케이션에 설정을 추가하자
- 모든 설정을 검증하고 로그에 기록하자


##### 레벨업을 위한 읽을거리
- Code Complete 코드 컴플리트
- Clean Code 클린 코드
- 아마존 빌더 라이브러리
- SRE를 위한 시스템 설계와 구축
- 사이트 신뢰성 엔지니어링